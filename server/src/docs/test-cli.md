# CLI для управления тестами

## Описание

CLI утилита для управления системой тестирования платформы "Каталог Маникюра". Предоставляет удобный интерфейс для запуска, мониторинга и управления тестами.

## Установка и настройка

Убедитесь, что у вас установлены все необходимые зависимости:

```bash
npm install
```

## Основные команды

### Запуск тестов

```bash
# Запуск всех тестов
npm run cli test run

# Запуск с подробным выводом
npm run cli test run --verbose

# Запуск конкретного файла
npm run cli test run --file auth.test.ts

# Запуск тестов по шаблону имени
npm run cli test run --pattern "auth"

# Остановка при первой ошибке
npm run cli test run --bail

# Тихий режим
npm run cli test run --silent

# Установка таймаута
npm run cli test run --timeout 30000
```

### Режим наблюдения

Запускает тесты в режиме наблюдения, автоматически перезапуская их при изменении файлов:

```bash
# Запуск в режиме наблюдения
npm run cli test watch

# С дополнительными опциями
npm run cli test watch --verbose --file auth.test.ts
```

### Анализ покрытия кода

```bash
# Запуск тестов с анализом покрытия
npm run cli test coverage

# С дополнительными опциями
npm run cli test coverage --bail
```

После выполнения отчет о покрытии будет доступен в папке `coverage/`.

### Управление тестовыми данными

```bash
# Очистка тестовых данных в базе
npm run cli test clean
```

### Диагностика

```bash
# Проверка настроек тестового окружения
npm run cli test setup

# Показ статуса тестовой системы
npm run cli test status
```

### Справка

```bash
# Показ справки
npm run cli test help
```

## Опции командной строки

| Опция | Краткая форма | Описание |
|-------|---------------|----------|
| `--verbose` | `-v` | Подробный вывод результатов |
| `--file` | `-f` | Запуск конкретного тестового файла |
| `--pattern` | `-p` | Фильтр по названию тестов |
| `--timeout` | `-t` | Таймаут для тестов в миллисекундах |
| `--bail` | `-b` | Остановка при первой ошибке |
| `--silent` | `-s` | Минимальный вывод |
| `--coverage` | `-c` | Включение анализа покрытия |
| `--watch` | `-w` | Режим наблюдения |

## Примеры использования

### Быстрая проверка

```bash
# Быстрый запуск всех тестов
npm run cli test run --bail --silent
```

### Разработка

```bash
# Работа над конкретным модулем
npm run cli test watch --file auth.test.ts --verbose
```

### Подготовка к продакшену

```bash
# Полный анализ перед деплоем
npm run cli test coverage --verbose
```

### Отладка проблем

```bash
# Подробная диагностика
npm run cli test setup
npm run cli test status
```

## Структура тестовых файлов

CLI автоматически обнаруживает следующие тестовые файлы:

- `src/__tests__/auth.test.ts` - тесты аутентификации
- `src/__tests__/designs.test.ts` - тесты работы с дизайнами
- `src/__tests__/masters.test.ts` - тесты функций мастеров
- `src/__tests__/orders.test.ts` - тесты системы заказов
- `src/__tests__/helpers/test.helper.ts` - вспомогательные функции
- `src/__tests__/setup.ts` - настройка тестового окружения

## Результаты тестов

### Формат вывода

CLI показывает:
- Общее количество тестов
- Количество пройденных тестов (зеленым)
- Количество провалившихся тестов (красным)
- Количество пропущенных тестов (желтым)
- Время выполнения

### Файлы результатов

- `test-results.json` - JSON отчет Jest
- `coverage/` - папка с отчетами о покрытии кода

## Интеграция с базой данных

CLI автоматически:
- Проверяет подключение к тестовой базе данных
- Настраивает окружение для тестов
- Очищает тестовые данные при необходимости

## Переменные окружения

CLI автоматически устанавливает:
- `NODE_ENV=test` для всех тестовых команд

## Устранение неполадок

### Тесты не запускаются

1. Проверьте настройку окружения:
```bash
npm run cli test setup
```

2. Убедитесь в наличии зависимостей:
```bash
npm install
```

### Проблемы с базой данных

1. Проверьте статус подключения:
```bash
npm run cli test status
```

2. Очистите тестовые данные:
```bash
npm run cli test clean
```

### Таймауты тестов

Увеличьте таймаут:
```bash
npm run cli test run --timeout 60000
```

## Интеграция с CI/CD

### GitHub Actions

```yaml
- name: Run tests
  run: npm run cli test run --bail --coverage

- name: Check test status
  run: npm run cli test status
```

### Локальные pre-commit хуки

```bash
# В package.json scripts
"precommit": "npm run cli test run --bail"
```

## Расширение функциональности

CLI можно расширить, добавив новые команды в класс `TestCLI`:

```typescript
// В src/cli/test.cli.ts
case 'new-command':
  await this.newCommand(args.slice(1));
  break;
```

## Связанные команды

- `npm test` - стандартный запуск тестов
- `npm run test:watch` - режим наблюдения
- `npm run test:coverage` - анализ покрытия
- `npm run cli db clean` - очистка всей базы данных 