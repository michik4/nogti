# –°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

## –û–±–∑–æ—Ä

–°–µ—Ä–≤–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ —Å middleware –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ 404 –æ—à–∏–±–æ–∫ –∏ –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –æ—à–∏–±–æ–∫.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–æ–≤

–í—Å–µ –æ—Ç–≤–µ—Ç—ã API, –≤–∫–ª—é—á–∞—è –æ—à–∏–±–∫–∏, —Å–ª–µ–¥—É—é—Ç –µ–¥–∏–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É:

```typescript
{
    success: boolean,        // true –¥–ª—è —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, false –¥–ª—è –æ—à–∏–±–æ–∫
    error: string | null,    // –æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ –∏–ª–∏ null –¥–ª—è —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
    message: string,         // —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    status: string,          // "ok" | "error" | "warning" | "info" | "in_progress"
    code: number,           // HTTP —Å—Ç–∞—Ç—É—Å –∫–æ–¥
    data: any              // –¥–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç–∞ –∏–ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–µ
}
```

## –¢–∏–ø—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

### 1. 404 - Not Found

–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è middleware `notFoundHandler`:

```typescript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã
app.use(notFoundHandler);
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ 404:**
```json
{
    "success": false,
    "error": "–ú–∞—Ä—à—Ä—É—Ç GET /nonexistent –Ω–µ –Ω–∞–π–¥–µ–Ω",
    "message": "–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–π —Ä–µ—Å—É—Ä—Å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç",
    "status": "error",
    "code": 404,
    "data": {
        "method": "GET",
        "url": "/nonexistent",
        "timestamp": "2024-01-15T10:30:00.000Z",
        "ip": "::1"
    }
}
```

### 2. –°–µ—Ä–≤–µ—Ä–Ω—ã–µ –æ—à–∏–±–∫–∏ (500, 400, etc.)

–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è middleware `errorHandler`:

```typescript
// –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫
app.use(errorLogger); // –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
app.use(errorHandler); // –æ–±—Ä–∞–±–æ—Ç–∫–∞
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –æ—à–∏–±–∫–∏:**
```json
{
    "success": false,
    "error": "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞",
    "message": "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞",
    "status": "error",
    "code": 500,
    "data": {
        "timestamp": "2024-01-15T10:30:00.000Z",
        "method": "POST",
        "url": "/api/users",
        "ip": "::1",
        "stack": "Error: Something went wrong..."  // —Ç–æ–ª—å–∫–æ –≤ development
    }
}
```

## Middleware –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### notFoundHandler
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –º–∞—Ä—à—Ä—É—Ç–∞–º
- –õ–æ–≥–∏—Ä—É–µ—Ç 404 –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª—å
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON –æ—Ç–≤–µ—Ç

### errorLogger
- –ü–æ–¥—Ä–æ–±–Ω–æ –ª–æ–≥–∏—Ä—É–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—à–∏–±–∫–∞—Ö
- –í–∫–ª—é—á–∞–µ—Ç IP, User-Agent, stack trace
- –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –≤—ã–≤–æ–¥ –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è

### errorHandler
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∫–æ–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ
- –í development —Ä–µ–∂–∏–º–µ –≤–∫–ª—é—á–∞–µ—Ç stack trace
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON –æ—Ç–≤–µ—Ç

### asyncErrorHandler
- –û–±–µ—Ä—Ç–∫–∞ –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö route handlers
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥–∞–µ—Ç –æ—à–∏–±–∫–∏ –≤ error handler

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –º–∞—Ä—à—Ä—É—Ç–∞—Ö

### –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏
```typescript
router.get("/error", (req, res, next) => {
    const error = new Error("–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏") as any;
    error.statusCode = 400;
    next(error);
});
```

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏
```typescript
router.get("/async", async (req, res, next) => {
    try {
        await someAsyncOperation();
        res.json({ success: true, ... });
    } catch (error) {
        next(error);
    }
});
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ asyncErrorHandler
```typescript
import { asyncErrorHandler } from "../middleware/error.middleware";

router.get("/async", asyncErrorHandler(async (req, res) => {
    await someAsyncOperation();
    res.json({ success: true, ... });
}));
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É–µ—Ç:

### 404 –æ—à–∏–±–∫–∏
```
‚ùå 404 Error: GET /nonexistent - IP: ::1
```

### –°–µ—Ä–≤–µ—Ä–Ω—ã–µ –æ—à–∏–±–∫–∏
```
üö® [2024-01-15T10:30:00.000Z] ERROR OCCURRED
üìç POST /api/users
üåê IP: ::1
üñ•Ô∏è  User-Agent: Mozilla/5.0...
üí• Error: Something went wrong
üìö Stack: Error: Something went wrong...
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
NODE_ENV=development  # –≤–∫–ª—é—á–∞–µ—Ç stack trace –≤ –æ—Ç–≤–µ—Ç–∞—Ö –æ—à–∏–±–æ–∫
```

## –¢–µ—Å—Ç–æ–≤—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã:

- `GET /error` - –∏–º–∏—Ç–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –æ—à–∏–±–∫–∏ 500
- `GET /async-error` - –∏–º–∏—Ç–∞—Ü–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ—à–∏–±–∫–∏
- `GET /nonexistent` - —Ç–µ—Å—Ç 404 –æ—à–∏–±–∫–∏

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í production —Ä–µ–∂–∏–º–µ stack trace –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è –≤ –æ—Ç–≤–µ—Ç—ã
- –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è
- –í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ 