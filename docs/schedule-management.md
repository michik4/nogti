# Система управления расписанием мастера

## Обзор

Система управления расписанием позволяет мастерам создавать и управлять своими временными окнами для приема клиентов. Клиенты могут видеть доступные временные слоты и бронировать их.

## Основные возможности

### Для мастеров:
- **Создание временных окон**: Мастера могут добавлять временные слоты на конкретные даты
- **Редактирование расписания**: Изменение времени, статуса и заметок для существующих окон
- **Удаление окон**: Удаление ненужных временных слотов
- **Множественный выбор дней**: Выбор нескольких дат для одновременного добавления временных окон
- **Копирование недельного расписания**: Создание шаблона недели на основе выбранных дат и применение его на будущие недели
- **Просмотр статистики**: Анализ загруженности по дням недели

### Для клиентов:
- **Просмотр доступных окон**: Клиенты видят только свободные временные слоты мастера
- **Бронирование**: Выбор удобного времени для записи
- **Интеграция с системой заказов**: Автоматическое создание заказа при бронировании

## Компоненты

### ScheduleManager

Основной компонент для управления расписанием мастера.

**Функциональность:**
- Календарь для выбора дат (одиночный или множественный режим)
- Просмотр временных окон на выбранную дату
- Добавление новых временных слотов
- Редактирование существующих окон
- Удаление временных слотов
- Множественный выбор дней для массового добавления окон
- Создание и применение недельных шаблонов

**Режимы работы:**
1. **Одиночный режим**: Выбор одной даты для работы с расписанием
2. **Множественный режим**: Выбор нескольких дат для массовых операций
3. **Режим шаблона недели**: Создание шаблона на основе выбранных дат

**Ключевые функции:**
- `handleAddSlot()`: Добавление временных окон на одну или несколько дат
- `handleCopyWeekSchedule()`: Создание шаблона недели из выбранных дат
- `handleApplyWeekTemplate()`: Применение шаблона на будущие 4 недели
- `handleUpdateSlot()`: Обновление существующего временного окна
- `handleDeleteSlot()`: Удаление временного окна

### DateTimeSelector

Компонент для выбора даты и времени при бронировании.

**Функциональность:**
- Выбор даты через календарь
- Отображение доступных временных слотов мастера
- Интеграция с системой расписания мастера
- Fallback на стандартные временные слоты при отсутствии расписания

**Пропсы:**
- `masterId`: ID мастера для получения расписания
- `useMasterSchedule`: Флаг использования расписания мастера
- `selectedDate`: Выбранная дата
- `selectedTime`: Выбранное время
- `onDateSelect`: Колбэк выбора даты
- `onTimeSelect`: Колбэк выбора времени

## API Endpoints

### Расписание мастера
- `GET /api/masters/:masterId/schedule` - Получить расписание мастера
- `GET /api/masters/schedule` - Получить свое расписание (требует авторизации)
- `POST /api/masters/schedule` - Добавить временное окно
- `PUT /api/masters/schedule/:slotId` - Обновить временное окно
- `DELETE /api/masters/schedule/:slotId` - Удалить временное окно

### Доступные слоты для клиентов
- `GET /api/masters/:masterId/schedule/available` - Получить доступные слоты на дату
- `PUT /api/masters/:masterId/schedule/:slotId/block` - Заблокировать слот
- `PUT /api/masters/:masterId/schedule/:slotId/unblock` - Разблокировать слот

## Типы данных

### TimeSlot
```typescript
interface TimeSlot {
  id: string;
  workDate: string;
  startTime: string;
  endTime: string;
  status: 'available' | 'booked' | 'blocked';
  notes?: string;
  createdAt: string;
  updatedAt: string;
}
```

### ScheduleDay
```typescript
interface ScheduleDay {
  date: string;
  timeSlots: TimeSlot[];
}
```

### CreateTimeSlotData
```typescript
interface CreateTimeSlotData {
  workDate: string;
  startTime: string;
  endTime: string;
  status?: 'available' | 'booked' | 'blocked';
  notes?: string;
}
```

## Интеграция с дашбордом мастера

Компонент `ScheduleManager` интегрирован в дашборд мастера через кнопку "Управление расписанием". Мастера могут:

1. Открыть управление расписанием из дашборда
2. Выбрать режим работы (одиночный/множественный)
3. Создать временные окна на одну или несколько дат
4. Создать шаблон недели для повторяющегося расписания
5. Применить шаблон на будущие недели

## Валидация и ограничения

### Серверная валидация:
- Проверка UUID формата для ID
- Валидация дат (нельзя создавать окна в прошлом)
- Проверка времени (окончание должно быть позже начала)
- Проверка пересечений временных окон
- Авторизация (только мастер может управлять своим расписанием)

### Клиентская валидация:
- Проверка выбора даты перед добавлением окна
- Валидация времени начала и окончания
- Проверка наличия выбранных дат в множественном режиме

## Статусы временных окон

- **available**: Свободно для бронирования
- **booked**: Забронировано клиентом
- **blocked**: Заблокировано мастером

## Безопасность

- Все операции с расписанием требуют авторизации
- Мастера могут управлять только своим расписанием
- Клиенты могут видеть только доступные слоты
- Валидация данных на сервере и клиенте

## Будущие улучшения

- [ ] Уведомления о новых бронированиях
- [ ] Напоминания о предстоящих встречах
- [ ] Статистика загруженности
- [ ] Интеграция с внешними календарями
- [ ] Автоматическое создание слотов по шаблону
- [ ] Мобильная версия интерфейса
- [ ] Экспорт расписания в iCal формат 