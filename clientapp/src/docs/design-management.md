# Управление дизайнами

## Архитектура

Система дизайнов использует несколько сущностей:
- **NailDesign** - основная сущность дизайна
- **MasterDesign** - связь "мастер может выполнить этот дизайн"
- **MasterServiceDesign** - связь "дизайн привязан к конкретной услуге мастера"

## Логика авторства

### Принципы авторства
- **Автор дизайна** - это пользователь, который создал дизайн (поле `uploadedByMaster` или `uploadedByClient`)
- **Дизайн показывается как "мой"** только у автора, независимо от того, сколько мастеров его привязали к своим услугам
- **Привязка к услуге** не меняет авторство дизайна

### Отображение дизайнов мастера
При получении дизайнов мастера (`/api/designs/master/:masterId`) возвращаются:
1. **Авторские дизайны** - дизайны, созданные самим мастером
2. **Привязанные дизайны** - дизайны других авторов, которые мастер привязал к своим услугам

### Модерация
- **Авторские дизайны**: мастер видит все свои дизайны (модерированные и немодерированные), другие пользователи - только модерированные
- **Привязанные дизайны**: показываются только модерированные дизайны других авторов

## Логика ценообразования

### Принципы ценообразования
- **Стоимость дизайна в рамках услуги** всегда соответствует стоимости услуги
- **Оригинальная цена дизайна** (`estimatedPrice`) не влияет на цену в рамках услуги
- **Дизайн как пример работы** - цена показывает стоимость выполнения этой работы в рамках конкретной услуги

### Установка цены
1. **При привязке существующего дизайна**: цена берется от услуги (`service.price`)
2. **При создании нового дизайна для услуги**: цена также берется от услуги
3. **Кастомная цена**: мастер может установить индивидуальную цену через `customPrice`

## Пользовательские сценарии

### Мастер создает дизайн для услуги
1. Выбирает услугу в модальном окне создания дизайна
2. Цена автоматически устанавливается равной цене услуги
3. Дизайн создается и автоматически привязывается к услуге
4. Дизайн остается авторским для мастера

### Мастер привязывает чужой дизайн к услуге
1. Выбирает услугу и дизайн из общей библиотеки
2. Дизайн привязывается к услуге с ценой услуги
3. Авторство дизайна остается у оригинального создателя
4. Дизайн появляется в списке дизайнов мастера как "привязанный"

### Клиент просматривает дизайны мастера
1. Видит авторские дизайны мастера (с пометкой авторства)
2. Видит привязанные дизайны (с указанием оригинального автора)
3. Все дизайны показаны с ценой соответствующей услуги мастера

## Техническая реализация

### Серверная часть
- `NailDesignController.getMasterDesigns()` - разделяет авторские и привязанные дизайны
- `MasterController.addDesignToService()` - устанавливает цену равную цене услуги
- Модерация применяется отдельно для авторских и привязанных дизайнов

### Клиентская часть
- `MasterDashboard` - обновлена логика привязки дизайнов
- `AddDesignModal` - автоматическая установка цены от услуги
- Отображение авторства в карточках дизайнов

## Изменения от предыдущей версии

### Исправленные проблемы
1. **Неправильное авторство**: дизайны больше не показываются как "мои" у всех мастеров, которые их привязали
2. **Неправильное ценообразование**: цена дизайна в услуге теперь всегда соответствует цене услуги
3. **Логическая связность**: дизайн как пример работы по услуге имеет цену этой услуги

### Обратная совместимость
- Существующие привязки дизайнов к услугам остаются рабочими
- API endpoints не изменились
- Клиентский интерфейс обновлен без breaking changes 