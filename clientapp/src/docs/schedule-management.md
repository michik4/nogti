# Система управления расписанием мастера

## Обзор

Система управления расписанием позволяет мастерам создавать и управлять своими временными окнами для приема клиентов. Клиенты могут видеть только доступные временные окна при бронировании.

## Основные возможности

### Для мастера:
- Создание временных окон на конкретные даты
- Редактирование существующих временных окон
- Удаление временных окон (кроме забронированных)
- Просмотр всех временных окон в календарном виде
- Установка статусов: свободно, забронировано, заблокировано

### Для клиента:
- Просмотр доступных временных окон при бронировании
- Выбор времени из доступных слотов
- Автоматическая блокировка выбранного времени

## Компоненты

### ScheduleManager
Основной компонент для управления расписанием мастера.

**Функции:**
- Календарь для выбора даты
- Список временных окон на выбранную дату
- Добавление новых временных окон
- Редактирование существующих окон
- Удаление временных окон

**Использование:**
```tsx
<ScheduleManager
  isOpen={isOpen}
  onClose={() => setIsOpen(false)}
/>
```

### DateTimeSelector (обновленный)
Компонент для выбора даты и времени с поддержкой расписания мастера.

**Новые пропсы:**
- `masterId` - ID мастера
- `useMasterSchedule` - использовать расписание мастера

**Использование:**
```tsx
<DateTimeSelector
  selectedDate={selectedDate}
  selectedTime={selectedTime}
  onDateSelect={setSelectedDate}
  onTimeSelect={setSelectedTime}
  masterId={masterId}
  useMasterSchedule={true}
/>
```

## API Endpoints

### Получение расписания
- `GET /api/masters/:masterId/schedule` - расписание конкретного мастера
- `GET /api/masters/schedule` - расписание текущего мастера

### Управление расписанием
- `POST /api/masters/schedule` - добавить временное окно
- `PUT /api/masters/schedule/:slotId` - обновить временное окно
- `DELETE /api/masters/schedule/:slotId` - удалить временное окно

### Бронирование
- `GET /api/masters/:masterId/schedule/available` - доступные окна для бронирования
- `PUT /api/masters/:masterId/schedule/:slotId/block` - заблокировать окно
- `PUT /api/masters/:masterId/schedule/:slotId/unblock` - разблокировать окно

## Типы данных

### TimeSlot
```typescript
interface TimeSlot {
  id: string;
  workDate: string;
  startTime: string;
  endTime: string;
  status: 'available' | 'booked' | 'blocked';
  notes?: string;
  createdAt: string;
  updatedAt: string;
}
```

### ScheduleDay
```typescript
interface ScheduleDay {
  date: string;
  timeSlots: TimeSlot[];
}
```

## Интеграция с дашбордом мастера

В дашборде мастера добавлена кнопка "Управление расписанием", которая открывает модальное окно ScheduleManager.

### Добавление в MasterDashboard:
```tsx
const [isScheduleManagerOpen, setIsScheduleManagerOpen] = useState(false);

// В профиле мастера
<Button 
  variant="outline" 
  className="w-full mb-2" 
  onClick={() => setIsScheduleManagerOpen(true)}
>
  <CalendarDays className="w-4 h-4 mr-2" />
  Управление расписанием
</Button>

// В конце компонента
<ScheduleManager
  isOpen={isScheduleManagerOpen}
  onClose={() => setIsScheduleManagerOpen(false)}
/>
```

## Валидация

### При создании временного окна:
- Дата не может быть в прошлом
- Время окончания должно быть больше времени начала
- Не должно быть пересечений с существующими окнами
- Только мастера могут создавать временные окна

### При бронировании:
- Клиент может выбрать только доступные окна
- Время автоматически блокируется при создании заказа
- При отмене заказа время разблокируется

## Статусы временных окон

- **available** - свободно для бронирования
- **booked** - забронировано клиентом
- **blocked** - заблокировано мастером

## Безопасность

- Мастера могут управлять только своими временными окнами
- Клиенты могут видеть только доступные окна
- Забронированные окна нельзя удалить
- Все операции требуют авторизации

## Будущие улучшения

1. **Повторяющиеся временные окна** - создание шаблонов расписания
2. **Уведомления** - уведомления о новых бронированиях
3. **Статистика** - анализ загруженности мастера
4. **Интеграция с календарем** - синхронизация с внешними календарями
5. **Автоматическое создание окон** - создание окон на основе шаблонов 